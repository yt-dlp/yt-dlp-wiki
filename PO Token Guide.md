[GOTO YouTube Extractor Wiki](https://github.com/yt-dlp/yt-dlp/wiki/Extractors#youtube)

# YouTube PO Token Guide

<!-- TOC -->
* [YouTube PO Token Guide](#youtube-po-token-guide)
    * [Background](#background)
  * [Current PO Token enforcement](#current-po-token-enforcement)
  * [Providing a PO Token manually](#providing-a-po-token-manually)
    * [GVS PO Token](#gvs-po-token)
      * [No account](#no-account)
      * [With an account](#with-an-account)
    * [Player PO Token](#player-po-token)
  * [Plugins](#plugins)
  * [Other PO Token related tools](#other-po-token-related-tools)
  * [Technical details](#technical-details)
    * [GVS PO Tokens](#gvs-po-tokens)
    * [Player PO Tokens](#player-po-tokens)
<!-- TOC -->

Proof of Origin (PO) token is a parameter that YouTube requires to be sent with requests from some clients. Without it, requests for the affected clients' format URLs may return HTTP Error 403, or result in your account or IP address being blocked.

For yt-dlp, you can provide PO Token(s) using the [`po_token` extractor argument](https://github.com/yt-dlp/yt-dlp#youtube), or you can install a plugin that hooks into the YouTube extractor to handle fetching a PO Token.

### Background

A PO Token is generated by either BotGuard (Web), DroidGuard (Android), iOSGuard (iOS) to attest the requests are coming from a genuine client.

There are two types of PO Tokens yt-dlp may require:
- GVS PO Token: This token is used on Google Video Server (GVS) requests.
- Player PO Token: This token is used on Innertube `player` requests.

These are not interchangeable, and you will need to provide both if you are using a client that requires both.

For more technical details on these tokens, refer to the [technical details section](#technical-details).

## Current PO Token enforcement

YouTube is at present rolling out changes to enforce PO Token requirements on clients. Currently, only GVS PO Tokens are required for some clients.

| Client         | GVS PO Token Required | Player PO Token Required | Notes                         |
|----------------|-----------------------|--------------------------|-------------------------------|
| `web`          | Yes                   | No                       |                               |
| `mweb`         | Yes                   | No                       |                               |
| `tv`           | No                    | No                       |                               |
| `tv_embedded`  | No                    | No                       |                               |
| `web_embedded` | No                    | No                       |                               |
| `web_music`    | Yes                   | No                       |                               |
| `web_creator`  | Yes                   | No                       | Requires account cookies      |
| `android`      | Yes                   | ?                        | Account cookies not supported |
| `android_vr`   | No                    | No                       |                               |
| `ios`          | Yes                   | ?                        | Account cookies not supported |

Note: HLS Formats do not require PO Token at this time.

You can select what client to use with the [`player_client` extractor argument](https://github.com/yt-dlp/yt-dlp#youtube).

## Providing a PO Token manually

This section provides a basic guide on extracting PO Token(s) manually from YouTube in a web browser **for use with the `web` client**, and manually passing it to yt-dlp via the [`po_token` extractor argument](https://github.com/yt-dlp/yt-dlp#youtube). The same PO Token(s) may work with other web browser-based clients too.

> [!TIP]
> When supplying multiple PO Tokens, use the same extractor args option and comma-separate the PO Token configurations. For example:
>   `--extractor-args "youtube:po_token=web.gvs+GVS_PO_TOKEN_VALUE_HERE,web.player+PLAYER_PO_TOKEN_VALUE_HERE"`


### GVS PO Token

The GVS PO Token is generated differently depending on whether you are using yt-dlp with an account. It can be used across multiple videos. See [Technical details](#technical-details) for more information.

#### No account

1. Open [YouTube Music](https://music.youtube.com) or YouTube Embedded (e.g. https://www.youtube.com/embed/aqz-KE-bpKQ) in a browser.  **Make sure you are not logged in to any account!**
2. Open any video
3. Open the developer console (F12), then go to the "Network" tab and filter by `googlevideo`
4. Click the video and play for a few seconds - requests to `googlevideo.com` should appear in the network tab
5. From the most recent `googlevideo.com` request, extract the `pot` query parameter value from the URL
6. [Export cookies from the browser](https://github.com/yt-dlp/yt-dlp/wiki/Extractors#exporting-youtube-cookies)
7. Pass the PO Token to yt-dlp using `--extractor-args "youtube:po_token=web.gvs+PO_TOKEN_VALUE_HERE"` with cookies (`--cookies COOKIES_FILE` or `--cookies-from-browser`)

Although not recommended, you may also provide visitor data instead of cookies. Refer to [Passing Visitor Data without cookies](https://github.com/yt-dlp/yt-dlp/wiki/Extractors#passing-visitor-data-without-cookies).

#### With an account

1. Open [YouTube Music](https://music.youtube.com) in a browser, and log in with the user you are using with yt-dlp
2. Open any video
3. Follow steps 3-5 above
4. Pass the PO Token to yt-dlp using `--extractor-args "youtube:po_token=web.gvs+PO_TOKEN_VALUE_HERE"` with your account cookies

Addendum:
- If there is no `pot` parameter in the `googlevideo.com` URL, wait a few seconds for more requests to be made and check them. 
- If there is a `sabr=1` query parameter in the `googlevideo.com` URL, then the PO Token is in the request body protobuf (and therefore is not easy to extract). 
  - This should not be the case for YouTube Music or YouTube Embedded - if so, please raise an issue so we can update these docs.


### Player PO Token

The Player PO Token is tied to the Video ID, so you must get a new Player PO Token for each video.

> [!NOTE]
> If you are using the `web` client and have not disabled the `webpage` request, providing this PO Token is not necessary.

1. Open [YouTube Web](https://www.youtube.com) in a browser.
2. Open the developer console (F12), then go to the "Network" tab and filter by `v1/player`
3. Navigate to the video you want to download (e.g. using search - do not go to the video url directly as the page will refresh)
4. In the request payload JSON, find the PO Token at `serviceIntegrityDimensions.poToken` and save that value
5. Export cookies from the browser
6. Pass the Player PO Token to yt-dlp using `--extractor-args "youtube:po_token=web.player+PO_TOKEN_VALUE_HERE"`

## Plugins

Manually fetching PO Tokens can be a tedious process. Alternatively, you can use a plugin that hooks into the YouTube extractor to handle fetching a PO Token.

- [yt-dlp-get-pot](https://github.com/coletdjnz/yt-dlp-get-pot) by [coletdjnz](https://github.com/coletdjnz)
  - An experimental plugin framework for yt-dlp to support fetching PO Tokens from external providers. _Maintained by a yt-dlp maintainer._
- [bgutil-ytdlp-pot-provider](https://github.com/Brainicism/bgutil-ytdlp-pot-provider) by [Brainicism](https://github.com/Brainicism)
  - A [yt-dlp-get-pot](https://github.com/coletdjnz/yt-dlp-get-pot) provider which uses [BgUtils](https://github.com/LuanRT/BgUtils) to generate PO Tokens. _Not affiliated with yt-dlp._

See the [yt-dlp-plugins GitHub topic](https://github.com/topics/yt-dlp-plugins) and the [yt-dlp plugin wiki](https://github.com/yt-dlp/yt-dlp/wiki/Plugins) to explore more yt-dlp plugins.

## Other PO Token related tools

- [BgUtils](https://github.com/LuanRT/BgUtils) by [LuanRT](https://github.com/LuanRT)
  - Utility to generate PoTokens and run BotGuard attestation challenges. 
- [YouTube Trusted Session Generator](https://github.com/iv-org/youtube-trusted-session-generator) by [Invidious](https://github.com/iv-org)
  - A generator for getting a session that passes all the checks from YouTube side

## Technical details

PO Tokens are still an active area of research, and at the same time YouTube is continuation updating the implementation and enforcement. The following information is based on the current understanding of PO Tokens.

### GVS PO Tokens

For GVS PO Tokens generated by BotGuard:
- When logged out, are bound to a Visitor ID. This Visitor ID is found in the `VISITOR_INFO1_LIVE` cookie, in the `visitorData` value which is sent with Innertube API requests, or with `ytcfg.get('VISITOR_DATA')` in the browser console.
- When logged in, are bound to the account Session ID (first part of the Data Sync ID). This can be found at `responseContext.mainAppWebResponseContext.dataSyncId` in Innertube responses, or with `ytcfg.get('DATASYNC_ID')` in the browser console.

If a video download fails with an HTTP 403 midway through, then the client likely requires a GVS PO Token.

These PO Token is only valid for a limited time (usually at least 12 hours), so it will need to be refreshed periodically. However, some reports suggest that the token may be valid for many days.

### Player PO Tokens

Player PO Tokens generated by BotGuard are bound to the video ID the associated `/player` request is for. YouTube has only recently started generating these for some clients (e.g. `web`).
