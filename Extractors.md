# YouTube

<!-- general section of status of downloading from youtube and what you need to do, pointing to the below sections -->

## Clients

<!-- general information on what a client is -->

## Exporting YouTube cookies

If you are unfamiliar with the basics of exporting cookies and passing them to yt-dlp, then first see [How do I pass cookies to yt-dlp?](https://github.com/yt-dlp/yt-dlp/wiki/FAQ#how-do-i-pass-cookies-to-yt-dlp)

YouTube rotates account cookies frequently on open YouTube browser tabs as a security measure.
To export cookies that will remain working with yt-dlp, you will need to export cookies in such a way that they are never rotated. 

Note: this is not necessary for guest sessions (i.e. not logged in) as they do not have rotating cookies.

One way to do this is through a private browsing/incognito window:
1. Open a new private browsing/incognito window and log into YouTube
2. Open a new tab and **close the YouTube tab**
3. Export cookies from the browser then **close the private browsing/incognito window** so the session is never opened in the browser again.

## Logging in with OAuth

> [!CAUTION]
> Due to new restrictions enacted by YouTube, logging in with OAuth no longer works with yt-dlp. [You should use cookies instead.](#exporting-youtube-cookies)


## PO Token Guide

* [Current PO Token requirement status](#current-po-token-requirement-status)
* [Manual PO Token acquisition](#manual-po-token-acquisition)
  * [GVS PO Token](#gvs-po-token)
    * [Logged Out](#logged-out)
    * [Logged In](#logged-in)
  * [Player PO Token](#player-po-token)
* [Plugins](#plugins)
* [Other Methods](#other-methods)
* [Technical details](#technical-details)

Proof of Origin (PO) token is a parameter that YouTube requires to be sent with requests from some clients. Without it, requests for the affected clients' format URLs may return HTTP Error 403, or result in your account or IP address being blocked.

There are two types of PO Tokens yt-dlp may need to handle:
- GVS Token: This token is used on Google Video Server (GVS) requests.
- Player Token: This token is used on Innertube `player` requests.

These are not interchangeable, and you will need to provide both if you are using a client that requires both.

These tokens are generated by BotGuard (Web) / DroidGuard (Android) / iOSGuard (iOS) to attest the requests are coming from a genuine client.
 
For more technical details on these tokens, refer to the [Technical details section](#technical-details).

For yt-dlp, you can provide PO Token(s) using the `po_token` extractor argument, or you can install a plugin that hooks into the YouTube extractor to handle fetching a PO Token.

### Current PO Token requirement status

<!-- mention that youtube working to enforce PO token requirement on all clients -->

| Client       | GVS Token Required | Player Token Required | Notes                                            |
|--------------|--------------------|-----------------------|--------------------------------------------------|
| web          | Yes                | No                    |                                                  |
| mweb         | Yes                | No                    |                                                  |
| tv           | No                 | No                    |                                                  |
| tv_embedded  | No                 | No                    |                                                  |
| web_embedded | No                 | No                    |                                                  |
| web_music    | Yes                | No                    |                                                  |
| web_creator  | Yes                | No                    | Requires cookies                                 |
| android      | Yes?               | ?                     | Does not work with cookies. Missing kids videos. |
| android_vr   | No?                | ?                     |                                                  |
| ios          | Yes?               | ?                     | Does not work with cookies                       |


Note: HLS Formats do not require PO Token at this time.

### Manual PO Token acquisition

This guide will be assuming the use of a PO Token generated by BotGuard, for use with the `web` client. The same PO Token may work with other web-based clients too.

Using a browser

The token is only valid for a limited time (usually at least 12 hours), so it will need to be refreshed periodically.

This process goes through manually obtaining a PO Token generated on YouTube in a web browser, and then manually passing that to yt-dlp via the `po_token` extractor argument. (LINK TO EXTRACTOR ARGUMENTS)

When supplying multiple po tokens, use the same --extractor-args option and comma-separate the po tokens configurations like so:
    
        --extractor-args "youtube:po_token=web.gvs+PO_TOKEN_VALUE_HERE,web.player+PLAYER_PO_TOKEN_VALUE_HERE"

#### GVS PO Token

The GVS PO Token is generated differently depending on whether you are logged in or logged out. It can be used across multiple videos. See [Technical details](#technical-details) for more information.

##### Logged Out

1. Open [YouTube Music](https://music.youtube.com) or YouTube Embedded (e.g. https://www.youtube.com/embed/aqz-KE-bpKQ) in a browser.  **Make sure you are not logged in to any account!**
2. Open any video
3. Open the developer console (F12), then go to the "Network" tab and filter by `googlevideo`
4. Click the video and play for a few seconds - requests to `googlevideo.com` should appear in the network tab
5. From the most recent `googlevideo.com` request, extract the `pot` query parameter value from the URL
6. [Export cookies from the browser](#exporting-youtube-cookies)
7. Pass the PO Token to yt-dlp using `--extractor-args "youtube:po_token=web.gvs+PO_TOKEN_VALUE_HERE"` with cookies (`--cookies COOKIES_FILE` or `--cookies-from-browser`)

Although not recommended, you may also provide visitor data instead of cookies. Refer to [Passing Visitor Data without cookies](#passing-visitor-data-without-cookies).

##### Logged In

1. Open [YouTube Music](https://music.youtube.com) in a browser, and log in with the user you are using with yt-dlp
2. Open any video
3. Follow steps 3-5 above
4. Pass the PO Token to yt-dlp using `--extractor-args "youtube:po_token=web.gvs+PO_TOKEN_VALUE_HERE"` with your account cookies

Addendum:
- If there is no `pot` parameter in the `googlevideo.com` URL, wait a few seconds for more requests to be made and check them. 
- If there is a `sabr=1` query parameter in the `googlevideo.com` URL, then the PO Token is in the request body protobuf (and therefore is not easy to extract). 
  - This should not be the case for YouTube Music or YouTube Embedded - if so, please raise an issue so we can update these docs.


#### Player PO Token

The Player PO Token is tied to the video ID, and so cannot be used across different videos.
- You must get a new Player PO Token for each video you want to download.

Note: If you are using the `web` client and have not disabled the `webpage` request, this should not be necessary.

Steps:
1. Open [YouTube Web](https://www.youtube.com) in a browser.
2. Open the developer console (F12), then go to the "Network" tab and filter by `v1/player`
3. Navigate to the video you want to download (e.g. using search - do not go to the video url directly as the page will refresh)
4. In the request payload JSON, find the PO Token at `serviceIntegrityDimensions.poToken` and save that value
5. Export cookies from the browser
6. Pass the Player PO Token to yt-dlp using `--extractor-args "youtube:po_token=web.player+PO_TOKEN_VALUE_HERE"`

### Plugins

If you do not want to manually fetch PO Tokens, you can use a plugin to automatically fetch them for you. 

- [yt-dlp-get-pot](https://github.com/coletdjnz/yt-dlp-get-pot) by [coletdjnz](https://github.com/coletdjnz)
  - An experimental plugin framework for yt-dlp to support fetching PO Tokens from external providers. Maintained by a yt-dlp maintainer.
- [bgutil-ytdlp-pot-provider](https://github.com/Brainicism/bgutil-ytdlp-pot-provider) by [Brainicism](https://github.com/Brainicism)
  - A [yt-dlp-get-pot](https://github.com/coletdjnz/yt-dlp-get-pot) provider which uses [BgUtils](https://github.com/LuanRT/BgUtils) to generate PO Tokens. Not affiliated with yt-dlp.

See the [yt-dlp-plugins GitHub topic](https://github.com/topics/yt-dlp-plugins) and [yt-dlp wiki plugin page](https://github.com/yt-dlp/yt-dlp/wiki/Plugins) to browse more yt-dlp plugins.

### Other Methods
- [BgUtils](https://github.com/LuanRT/BgUtils) by [LuanRT](https://github.com/LuanRT)
  - Utility to generate PoTokens and run BotGuard attestation challenges. 
- [YouTube Trusted Session Generator](https://github.com/iv-org/youtube-trusted-session-generator) by [Invidious](https://github.com/iv-org)
  - A generator for getting a session that passes all the checks from YouTube side

### Technical details

For GVS PO Tokens generated by BotGuard:
- When logged out, are bound to a Visitor ID. This Visitor ID is found in the `VISITOR_INFO1_LIVE` cookie, or in the `visitorData` value which is sent with Innertube API requests.
- When logged in, are bound to the account Session ID (part of the Data Sync ID).

Player PO Tokens generated by BotGuard are bound to the video ID the associated player request is for.

## Passing Visitor Data without cookies

In some cases, you may not want to use cookies and instead pass Visitor Data to use in Innertube API requests. 

> [!WARNING]
> This method is **not recommended** for most cases. It requires skipping webpage requests so that the `VISITOR_INFO1_LIVE` cookie does not interfere. This results in more requests needing to be sent as well as less stable extraction.

You can do this with:

    --extractor-args "youtube:visitor_data=VISITOR_DATA_VALUE_HERE"